# Maintainer: acxz <akashpatel2008 at yahoo dot com>
pkgname=airsim
pkgver=1.8.1
pkgrel=1
pkgdesc="Open source simulator for autonomous vehicles built on Unreal Engine /
Unity, from Microsoft AI & Research"
url="https://microsoft.github.io/AirSim"
arch=(x86_64)
license=('MIT')
depends=(unreal-engine rpclib eigen)
makedepends=(cmake gcc)
_pkgname=AirSim
source=("${pkgname}-${pkgver}::https://github.com/microsoft/AirSim/archive/refs/tags/v${pkgver}.tar.gz"
        "CMakeLists.patch")
sha256sums=("92cebb9350d1364fdeacc84660ea2250c7ef500a2971925a0c9cd5065d07496b"
            "15fa367328cc241ee73cdf5fb139d31e8c4ac4f3c8151b60c123d8170c4e041a")

prepare() {
    patch -s -p0 < CMakeLists.patch
}

build() {
  mkdir -p "$srcdir/${_pkgname}-${pkgver}/cmake/build"
  cd "$srcdir/${_pkgname}-${pkgver}/cmake/build"
  cmake -DCMAKE_INSTALL_PREFIX="$pkgdir/opt" ..
  make
}

package() {
  cd "$srcdir/${_pkgname}-${pkgver}/cmake/build"

  msg "Installing files"

  # AirLib
  mkdir -p ${pkgdir}/opt/airsim/AirLib/lib/x64/Release
  cp output/lib/libAirLib.a ${pkgdir}/opt/airsim/AirLib/lib
  cp -r output/lib/ ${pkgdir}/opt/airsim/AirLib/lib/x64/Release

  # MavLinkCom
  mkdir -p ${pkgdir}/opt/airsim/AirLib/deps/MavLinkCom/lib
  cp output/lib/libMavLinkCom.a ${pkgdir}/opt/airsim/AirLib/deps/MavLinkCom/lib
  cp -r ../../MavLinkCom/include ${pkgdir}/opt/airsim/AirLib/deps/MavLinkCom

  # Unreal
  mkdir -p ${pkgdir}/opt/airsim/Unreal/Plugins/AirSim/Source
  cp -r ../../AirLib ${pkgdir}/opt/airsim/Unreal/Plugins/AirSim/Source
  mkdir -p ${pkgdir}/opt/airsim/Unreal/Environments/Blocks/Plugins
  cp -r ../../Unreal/Plugins/AirSim ${pkgdir}/opt/airsim/Unreal/Environments/Blocks/Plugins
}
